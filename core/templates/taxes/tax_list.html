{% extends "adminbase.html" %}
{% block content %}

<div class="app-content-header">
  <div class="container-fluid">
    <div class="d-flex align-items-center justify-content-between">
      <h4 class="mb-0">Taxes</h4>
      <a href="{% url 'core:tax_add' %}" class="btn btn-sm btn-primary">
        <i class="bi bi-plus-lg me-1"></i> Add Tax
      </a>
    </div>
  </div>
</div>

<div class="app-content">
  <div class="container-fluid">

    <div class="card">
      <div class="card-body">

        <form method="get" class="row g-2 align-items-end mb-3">
          <div class="col-md-5">
            <label class="form-label small">Search</label>
            <input type="text" name="q" value="{{ q }}" class="form-control form-control-sm" placeholder="code / name / category">
          </div>

          <div class="col-md-3">
            <label class="form-label small">Active</label>
            <select name="active" class="form-select form-select-sm">
              <option value="" {% if active == "" %}selected{% endif %}>All</option>
              <option value="1" {% if active == "1" %}selected{% endif %}>Active</option>
              <option value="0" {% if active == "0" %}selected{% endif %}>Inactive</option>
            </select>
          </div>

          <div class="col-md-4 d-flex gap-2">
            <button class="btn btn-sm btn-secondary" type="submit">
              <i class="bi bi-search me-1"></i> Filter
            </button>
            <a class="btn btn-sm btn-outline-secondary" href="{% url 'core:tax_list' %}">Reset</a>
          </div>
        </form>

        <div class="table-responsive cc-table">
          <table class="table table-sm table-hover align-middle cc-table-main">
            <thead>
              <tr>
                <th style="width: 120px;">Code</th>
                <th>Name</th>
                <th style="width: 90px;">Rate</th>
                <th style="width: 120px;">Category</th>
                <th style="width: 110px;">Usage</th>
                <th>Output Account</th>
                <th>Input Account</th>
                <th style="width: 90px;">Active</th>
                <th style="width: 140px;" class="text-end">Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for t in taxes %}
                <tr>
                  <td class="fw-semibold">{{ t.code }}</td>
                  <td>
                    {{ t.name }}
                    {% if t.is_withholding %}
                      <span class="badge bg-info ms-1">Withholding</span>
                    {% endif %}
                  </td>
                  <td class="text-end">{{ t.rate }}%</td>
                  <td>{{ t.category.code }}</td>
                  <td>{{ t.get_usage_display }}</td>
                  <td>
                    {% if t.output_account %}{{ t.output_account.code }} - {{ t.output_account.name }}{% else %}-{% endif %}
                  </td>
                  <td>
                    {% if t.input_account %}{{ t.input_account.code }} - {{ t.input_account.name }}{% else %}-{% endif %}
                  </td>
                  <td>
                    {% if t.is_active %}
                      <span class="badge bg-success">Yes</span>
                    {% else %}
                      <span class="badge bg-secondary">No</span>
                    {% endif %}
                  </td>
                  <td class="text-end">
                    <a href="{% url 'core:tax_edit' t.pk %}" class="btn btn-sm btn-outline-primary">
                      <i class="bi bi-pencil"></i>
                    </a>
                    <a href="{% url 'core:tax_delete' t.pk %}" class="btn btn-sm btn-outline-danger">
                      <i class="bi bi-trash"></i>
                    </a>
                  </td>
                </tr>
              {% empty %}
                <tr><td colspan="9" class="text-center text-muted py-4">No data</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        {% if is_paginated %}
          <nav class="mt-3">
            <ul class="pagination pagination-sm mb-0">
              {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?q={{ q }}&active={{ active }}&page={{ page_obj.previous_page_number }}">Prev</a></li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">Prev</span></li>
              {% endif %}

              <li class="page-item disabled"><span class="page-link">Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>

              {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?q={{ q }}&active={{ active }}&page={{ page_obj.next_page_number }}">Next</a></li>
              {% else %}
                <li class="page-item disabled"><span class="page-link">Next</span></li>
              {% endif %}
            </ul>
          </nav>
        {% endif %}

      </div>
    </div>

  </div>
</div>

{% endblock %}
