{% load indo_format %}

{% if not rows %}
  <div class="alert alert-warning mb-0">
    Tidak ada cost line vendor yang bisa dibooking untuk Job Order ini.
  </div>
{% else %}
  <div class="table-responsive">
    <table class="table table-sm align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th style="width:44px">
            <input type="checkbox" id="chk-all">
          </th>
          <th>Description</th>
          <th style="width:180px">Vendor</th>
          <th style="width:220px">Cost Line</th>
          <th style="width:90px">UOM</th>
          <th style="width:110px" class="text-end">Remaining</th>
          <th style="width:130px" class="text-end">Unit Price</th>
          <th style="width:140px" class="text-end">Allocate Qty</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
          <tr>
            <td>
              <input class="form-check-input" type="checkbox" name="pick" value="{{ r.jc.id }}">
            </td>
            <td class="small text-muted">{{ r.jc.description|default:"-" }}</td>
            <td class="small">{{ r.vendor_name }}</td>
            <td class="fw-semibold">
              {{ r.cost_type_name }}
              {% if r.cost_group %}
                <div class="small text-muted">{{ r.cost_group }}</div>
              {% endif %}
            </td>
            <td class="small">{{ r.uom }}</td>
            <td class="text-end">{{ r.remaining }}</td>
            <td class="text-end">{{ r.unit_price|indo_number }}</td>
            <td class="text-end">
              <input type="number"
                     name="qty_{{ r.jc.id }}"
                     class="form-control form-control-sm text-end"
                     step="0.000001"
                     min="0"
                     max="{{ r.remaining }}"
                     data-remaining="{{ r.remaining }}"
                     data-id="{{ r.jc.id }}"
                     value="">
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="small text-muted mt-2">
    Note: Satu Vendor Booking hanya bisa berisi item dari vendor & cost group yang sama.
  </div>
{% endif %}
