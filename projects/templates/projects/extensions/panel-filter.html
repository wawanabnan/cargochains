<div class="offcanvas offcanvas-end" tabindex="-1" id="filtersOffcanvas" aria-labelledby="filtersOffcanvasLabel">
  <div class="offcanvas-header">
    <h6 class="offcanvas-title" id="filtersOffcanvasLabel">Filters</h6>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body">
    <form method="get" class="vstack gap-3">

      {# bawa query lain kecuali pagination & field filter utama #}
      {% for key, val in request.GET.items %}
        {% if key not in 'page project category ccy date_from date_to amin amax has_attach q sort dir' %}
          <input type="hidden" name="{{ key }}" value="{{ val }}">
        {% endif %}
      {% endfor %}

      <div>
        <label class="form-label small">Project</label>
        <select name="project" class="form-select form-select-sm" multiple size="8">
          {% for p in projects %}
            <option value="{{ p.id }}" {% if p.id in flt_projects %}selected{% endif %}>
              {{ p.number }} — {{ p.name }}
            </option>
          {% endfor %}
        </select>
        <div class="form-text">Ctrl/⌘ untuk multi pilih</div>
      </div>

      <div>
        <label class="form-label small">Category</label>
        <select name="category" class="form-select form-select-sm" multiple size="8">
          {% for cat in categories %}
            <option value="{{ cat.id }}" {% if cat.id in flt_categories %}selected{% endif %}>
              {{ cat.name }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="row g-2">
        <div class="col-6">
          <label class="form-label small">Date From</label>
          <input type="date" name="date_from" value="{{ date_from }}" class="form-control form-control-sm">
        </div>
        <div class="col-6">
          <label class="form-label small">Date To</label>
          <input type="date" name="date_to" value="{{ date_to }}" class="form-control form-control-sm">
        </div>
      </div>

      <div class="row g-2">
        <div class="col-6">
          <label class="form-label small">Amount Min</label>
          <input type="text" inputmode="decimal" name="amin" value="{{ amin }}" class="form-control form-control-sm" placeholder="e.g. 1000000">
        </div>
        <div class="col-6">
          <label class="form-label small">Amount Max</label>
          <input type="text" inputmode="decimal" name="amax" value="{{ amax }}" class="form-control form-control-sm" placeholder="e.g. 5000000">
        </div>
      </div>

      <div>
        <label class="form-label small">Currency</label>
        <select name="ccy" class="form-select form-select-sm">
          <option value="">All</option>
          {% for c in currencies %}
            <option value="{{ c }}" {% if c == flt_ccy %}selected{% endif %}>{{ c }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="checkbox" value="1" id="chkAttach" name="has_attach" {% if has_attach %}checked{% endif %}>
        <label class="form-check-label small" for="chkAttach">
          With attachment only
        </label>
      </div>

      <div class="d-flex gap-2">
        <button class="btn btn-primary btn-sm" type="submit">
          <i class="fa fa-filter me-1"></i> Apply
        </button>
        <a href="{{ request.path }}" class="btn btn-outline-secondary btn-sm">Reset</a>
      </div>
    </form>
  </div>
</div>
