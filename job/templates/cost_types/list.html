{% extends "adminbase.html" %}
{% block content %}
<div class="app-content-header">
  <div class="container-fluid d-flex justify-content-between align-items-center">

    <h4 class="mb-0">Cost Types</h4>

    <!-- ACTION BUTTONS -->
    <div class="d-flex gap-2 flex-wrap">

      <!-- ADD -->
      <a href="{% url 'job:cost_type_add' %}"
         class="btn btn-outline-primary btn-sm">
        <i class="bi bi-plus-lg me-1"></i> Add
      </a>

      <!-- EXPORT -->
      <a href="{% url 'job:cost_type_export' %}"
         class="btn btn-outline-success btn-sm">
        <i class="bi bi-download me-1"></i> Export
      </a>

      <!-- IMPORT -->
      <button class="btn btn-outline-primary btn-sm"
              data-bs-toggle="modal"
              data-bs-target="#importModal">
        <i class="bi bi-upload me-1"></i> Import
      </button>

    </div>

  </div>
</div>


<div class="app-content">
  <div class="container-fluid">
    <div class="card">
      <div class="card-body p-0">
          <div class="table-responsive cc-table">
            <table class="table table-sm cc-table-main table-hover mb-0">
               <thead class="table-light">
                <tr>
                  <th style="width:170px;">Code</th>
                  <th>Name</th>
                  <th style="width:200px;">Group</th>
                  <th>COGS Account</th>
                  <th class="text-center" style="width:80px;">Active</th>
                  <th style="width:80px;"></th>
                </tr>
              </thead>
            <tbody>
              {% for x in items %}
              <tr class="{% if not x.cogs_account %}table-warning{% endif %}">
                <td>{{ x.code }}</td>
                <td>{{ x.name }}</td>
                <td>{{ x.cost_group|default:"-" }}</td>
                <td>
                  {% if x.cogs_account %}
                    {{ x.cogs_account.code }} â€“ {{ x.cogs_account.name }}
                  {% else %}
                    <span class="text-danger fw-semibold">NOT SET</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  {% if x.is_active %}
                    <span class="badge bg-success">Yes</span>
                  {% else %}
                    <span class="badge bg-secondary">No</span>
                  {% endif %}
                </td>
                <td class="text-end">
                  <a href="{% url 'job:cost_type_edit' x.pk %}"
                    class="badge text-bg-success  py-1 px-2">
                    <i class="bi bi-pencil"></i>
                  </a>
                </td>
              </tr>
              {% empty %}
              <tr>
                <td colspan="6" class="text-center text-muted py-4">
                  No cost types found
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          </div>
      </div>
             
      <div class="card-footer py-2" style="border-top:none">
                <nav aria-label="Job Order pages">
                  <ul class="pagination mb-0 justify-content-end pagination-sm">

                    <!-- Previous -->
                    {% if page_obj.has_previous %}
                      <li class="page-item">
                        <a class="page-link"
                          href="?page={{ page_obj.previous_page_number }}&q={{ filter_q }}&customer={{ filter_customer }}&service={{ filter_service }}&date_from={{ filter_date_from }}&date_to={{ filter_date_to }}">
                          Previous
                        </a>
                      </li>
                    {% else %}
                      <li class="page-item disabled">
                        <span class="page-link">Previous</span>
                      </li>
                    {% endif %}

                    <!-- Page numbers -->
                    {% for num in page_obj.paginator.page_range %}
                      {% if num == page_obj.number %}
                        <li class="page-item active">
                          <span class="page-link">{{ num }}</span>
                        </li>
                      {% elif num > page_obj.number|add:"-3" and num < page_obj.number|add:"3" %}
                        <li class="page-item">
                          <a class="page-link"
                            href="?page={{ num }}&q={{ filter_q }}&customer={{ filter_customer }}&service={{ filter_service }}&date_from={{ filter_date_from }}&date_to={{ filter_date_to }}">
                            {{ num }}
                          </a>
                        </li>
                      {% endif %}
                    {% endfor %}

                    <!-- Next -->
                    {% if page_obj.has_next %}
                      <li class="page-item">
                        <a class="page-link"
                          href="?page={{ page_obj.next_page_number }}&q={{ filter_q }}&customer={{ filter_customer }}&service={{ filter_service }}&date_from={{ filter_date_from }}&date_to={{ filter_date_to }}">
                          Next
                        </a>
                      </li>
                    {% else %}
                      <li class="page-item disabled">
                        <span class="page-link">Next</span>
                      </li>
                    {% endif %}

                  </ul>
                </nav>
      </div>
         
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="importModal" tabindex="-1">
  <div class="modal-dialog">
    <form method="post"
          action="{% url 'job:cost_type_import' %}"
          enctype="multipart/form-data"
          class="modal-content">

      {% csrf_token %}

      <div class="modal-header">
        <h5 class="modal-title">Import Cost Types</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <div class="mb-3">
          <label class="form-label">File CSV</label>
          <input type="file"
                 name="file"
                 class="form-control form-control-sm"
                 accept=".csv"
                 required>
        </div>

        <div class="small text-muted">
          Kolom wajib:
          <code>code,name,cost_group,requires_vendor,is_active,sort_order</code>
        </div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary btn-sm"
                data-bs-dismiss="modal">
          Cancel
        </button>
        <button class="btn btn-primary btn-sm">
          <i class="bi bi-upload me-1"></i> Import
        </button>
      </div>

    </form>
  </div>
</div>

{% endblock %}
