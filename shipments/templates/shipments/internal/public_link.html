<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CS - Public Tracking Link</title>
  <style>
    body { font-family: Arial; margin: 24px; }
    .card { max-width: 860px; border:1px solid #ddd; border-radius:10px; padding:16px; }
    .row { margin-top: 12px; }
    .err { color:#b00020; margin-top: 8px; }
    label { display:block; font-size:12px; color:#666; margin-bottom:6px; }
    input { width:100%; padding:10px; }
    select, button { padding:10px 14px; }
    .actions { display:flex; gap:10px; align-items:center; margin-top: 10px; }
    .muted { font-size:12px; color:#666; }
  </style>
</head>
<body>
  <div class="card">
    <h2 style="margin:0;">CS Tool â€” Public Tracking Link</h2>
    <div class="muted">Cari shipment lalu generate link tracking untuk customer.</div>

    <div class="row">
      <form method="post">
        {% csrf_token %}
        <input type="hidden" name="action" value="search" />
        <label>Tracking No</label>
        <input name="tracking_no" placeholder="contoh: SHP202602-00001" />
        <div class="actions">
          <button type="submit">Search</button>
        </div>
        {% if error %}<div class="err">{{ error }}</div>{% endif %}
      </form>
    </div>

    {% if shipment %}
      <hr style="margin:18px 0;" />

      <div class="row">
        <div><b>Found:</b> {{ shipment.tracking_no }}</div>
        <div class="muted">Shipment ID: {{ shipment.id }} | Status: {{ shipment.status }}</div>
      </div>

      <div class="row">
        <form method="post">
          {% csrf_token %}
          <input type="hidden" name="action" value="generate" />
          <input type="hidden" name="shipment_id" value="{{ shipment.id }}" />

          <label>TTL (days)</label>
          <select name="ttl_days">
            <option value="7"  {% if result.ttl_days == 7 %}selected{% endif %}>7</option>
            <option value="30" {% if not result or result.ttl_days == 30 %}selected{% endif %}>30</option>
            <option value="90" {% if result.ttl_days == 90 %}selected{% endif %}>90</option>
            <option value="180" {% if result.ttl_days == 180 %}selected{% endif %}>180</option>
            <option value="365" {% if result.ttl_days == 365 %}selected{% endif %}>365</option>
          </select>

          <div class="actions">
            <button type="submit">Generate Link</button>
          </div>
        </form>
      </div>
    {% endif %}

    {% if result %}
      <div class="row">
        <label>Public URL</label>
        <input id="trackingUrl" value="{{ result.url }}" readonly />
        <div class="actions">
          <button type="button" onclick="copyLink()">Copy</button>
          <a href="{{ result.url }}" target="_blank">Open</a>
          <span class="muted" style="margin-left:auto;">Expires: {{ result.expires_at }}</span>
        </div>
      </div>
    {% endif %}
  </div>

  <script>
    function copyLink() {
      const el = document.getElementById("trackingUrl");
      if (!el) return;
      el.select();
      el.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(el.value);
      alert("Copied!");
    }
  </script>
</body>
</html>
