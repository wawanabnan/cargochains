
{% load static %}
<div class="card shadow-sm border-0">
  <div class="card-header bg-white d-flex align-items-center justify-content-between">
    <div>
      <h5 class="mb-0">Shipment #{{ form.instance.number|default:"(draft)" }}</h5>
      <small class="text-muted">Status: {{ form.instance.status|default:"DRAFT" }}</small>
    </div>
    <div class="d-flex gap-2">
      <a class="btn btn-outline-secondary btn-sm" href="{% url 'shipment:list' %}">Back</a>
    </div>
  </div>

  <div class="card-body">
    <form method="post" class="mb-3">
      {% csrf_token %}
      <div class="row g-3">
        <div class="col-md-6">{{ form.origin.label_tag }} {{ form.origin }}</div>
        <div class="col-md-6">{{ form.destination.label_tag }} {{ form.destination }}</div>
        <div class="col-md-6">{{ form.shipper.label_tag }} {{ form.shipper }}</div>
        <div class="col-md-6">{{ form.consignee.label_tag }} {{ form.consignee }}</div>
        <div class="col-md-4">{{ form.carrier.label_tag }} {{ form.carrier }}</div>
        <div class="col-md-4">{{ form.agency.label_tag }} {{ form.agency }}</div>
        <div class="col-md-4">{{ form.bill_of_lading_no.label_tag }} {{ form.bill_of_lading_no }}</div>

        <div class="col-md-4">{{ form.etd.label_tag }} {{ form.etd }}</div>
        <div class="col-md-4">{{ form.eta.label_tag }} {{ form.eta }}</div>
        <div class="col-md-4">{{ form.status.label_tag }} {{ form.status }}</div>

        <div class="col-md-4">{{ form.qty.label_tag }} {{ form.qty }}</div>
        <div class="col-md-4">{{ form.weight.label_tag }} {{ form.weight }}</div>
        <div class="col-md-4">{{ form.volume.label_tag }} {{ form.volume }}</div>

        <div class="col-12">{{ form.cargo_description.label_tag }} {{ form.cargo_description }}</div>
      </div>
      <div class="mt-3 d-flex gap-2">
        <button class="btn btn-primary btn-sm">Save</button>
      </div>
    </form>

    <ul class="nav nav-tabs" id="shipTabs" role="tablist">
      <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-routes" type="button">Routes</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-transport" type="button">Transportation Types</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-docs" type="button">Documents</button></li>
      <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-logs" type="button">Logs</button></li>
    </ul>

    <div class="tab-content pt-3">
      <div class="tab-pane fade show active" id="tab-routes">
        {% include "shipment/_routes_formset.html" %}
      </div>
      <div class="tab-pane fade" id="tab-transport">
        {% include "shipment/_transport_table.html" %}
      </div>
      <div class="tab-pane fade" id="tab-docs">
        {% include "shipment/_documents_formset.html" %}
      </div>
      <div class="tab-pane fade" id="tab-logs">
        {% include "shipment/_status_logs.html" %}
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('shown.bs.tab', e => history.replaceState(null, '', e.target.dataset.bsTarget));
const target = location.hash && document.querySelector(`button[data-bs-target="${location.hash}"]`);
if (target) new bootstrap.Tab(target).show();
</script>
