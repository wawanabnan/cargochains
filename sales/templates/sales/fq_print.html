{% load static %}
{% load indo_format %}

{% static 'img/logo.png' as fallback_logo %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Freight Quotation {{ fq.number }}</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      font-size: 13px;
      background: #f5f5f5;
    }

    .page {
      width: 210mm;
      min-height: 297mm;
      margin: 5mm auto;
      padding: 15mm;
      background: #fff;
      /* border: 1px solid #ccc; ‚Üê DIBUANG */
    }

    .quotation-header {
      font-size: 24px;
      text-align: center;
    }
    /* HEADER */
    .header-table {
      width: 100%;
      padding-bottom: 10px;
      margin-bottom: 12px;
      border-bottom: 0px solid #888;
    }
    .header-table td {
      vertical-align: top;
    }

    .company-info {
      text-align: right;
      font-size: 12px;
      line-height: 1.5;
    }

    h1 {
      font-size: 20px;
      margin: 0 0 8px 0;
    }

    .section-title {
      font-weight: bold;
      font-size: 15px;
      margin-top: 18px;
      margin-bottom: 6px;
      padding-bottom: 3px;
      border-bottom: 1px solid #bbb;
    }

    .field-label {
      font-weight: bold;
      margin-top: 6px;
    }
    .field-value {
      margin-bottom: 4px;
    }

    /* PRICING TABLE */
    table.pricing, table.service {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 12px;
    }
    table.pricing th,
    table.service th {
      background: #f0f0f0;
      padding: 6px;
      border: 1px solid #ddd;
      font-weight: bold;
    }
    table.pricing td,
    table.service td {
      padding: 6px;
      border: 1px solid #e2e2e2;
    }

    .text-right { text-align: right; }
    .text-center { text-align: center; }
    .text-left { text-align: left; }

    .footer-sign {
      margin-top: 28px;
      font-size: 12px;
      line-height: 1.6;
    }

    /* PRINT TOOLBAR (Hanya muncul saat preview) */
    .print-toolbar {
      width: 210mm;
      margin: 5mm auto 0;
      text-align: right;
    }
    .btn {
      display: inline-block;
      padding: 6px 14px;
      border-radius: 4px;
      border: 1px solid #777;
      background: #fff;
      cursor: pointer;
      font-size: 12px;
      margin-left: 4px;
    }
    .btn-primary {
      background: #005fcc;
      color: #fff;
      border-color: #004fa8;
    }

    @media print {
      body { background: #fff; }
      .page {
        margin: 0;
        padding: 12mm;
      }
      .print-toolbar { display: none !important; }
    }

        .notes-table {
      width: 100%;
      margin-top: 10px;
      font-size: 12px;
    }
    .notes-table td {
      vertical-align: top;
      padding-right: 10px;
    }
    .notes-title {
      font-weight: bold;
      margin-bottom: 4px;
      font-size: 13px;
    }
    .notes-table ul {
      margin: 0 0 6px 16px;
      padding: 0;
    }
    .notes-table li {
      margin-bottom: 3px;
    }

  .customer-notes table {
    width: 100% !important;
    border:none;
    border-collapse: collapse !important;
    border-spacing: 0 !important;
    table-layout: fixed; /* supaya kolom stabil */
    font-size: 12px;
  }

  .customer-notes colgroup col {
    width: 50% !important;   /* paksa 2 kolom seimbang */
  }

  .customer-notes td,
  .customer-notes th {
    border: 0px solid #555 !important; 
    padding: 3px 6px !important;
    vertical-align: top;
  }

  .customer-notes p {
    margin: 0 0 4px 0 !important;  /* hilangin margin besar bawaan TinyMCE */
  }

  .customer-notes ul,
  .customer-notes ol {
    margin: 0 0 4px 16px !important;
    padding: 0;
  }
  </style>
</head>

<body>

{% if not is_pdf %}
<div class="print-toolbar">
  <button class="btn" onclick="window.close()">Close</button>
  <button class="btn btn-primary" onclick="window.print()">Print</button>
</div>
{% endif %}

<div class="page">

  <!-- HEADER -->
  <table class="header-table">
    <tr>
      <td style="width: 50%;">
        <img src="{{ logo_path|default:fallback_logo }}" style="width: 150px;">
      </td>
      <td style="width: 50%;">
        <div class="company-info">
          
        </div>
      </td>
    </tr>
  </table>

  <br>
  Jakarta, {{ fq.shipment_plan_date|date:"d M Y"|default:"-" }}
  <br>
  <br>
  
  <table style="width:100%">
    <tr>
      <td class="text-left" style="width:50%">
        <div class="customer-address">
        <strong>To</strong><br>  
        Mr. mr <br>
        <strong>{{ fq.customer.company_name|default:fq.customer.name }}</strong><br>
        {{ fq.customer_address_text|linebreaksbr }}
      </div>

      </td>
      <td class="text-right" style="vertical-align: top;"><h3 style="margin-bottom: 0px;">QUOTATION</h3>#{{ fq.number }}</td>

    </tr>

  </table>
  <br>
  <br>
  <br>
  <table class="service">
    <tr>
      <th class="text-left">
        <div class="field-label">SHIPMENT ROUTE</div>
      
      </th>
      <th class="text-left" style="width:18%">
         <div class="field-label">SERVICE</div>
        
      </th>
      
      <th class="text-center" style="width:14%">
        <div class="field-label">SHIPMENT PLAN</div>
       
      </th>
      <th class="text-center" style="width:12%">
        <div class="field-label">VALID UNTIL</div>
        
      </th>
       <th class="text-center" style="width:14%">
        <div class="field-label">PAYMENT TERM</div>
        
      </th>
    </tr>
    <tr>
      <td>
        
        <div class="field-value ">{{ fq.route_name }}</div>
      </td>
      <td style="width:15%">
        <div class="field-value">{{ fq.sales_service.name }}</div>
      </td>
      
      <td class="text-center">
       
        <div class="field-value">{{ fq.shipment_plan_date|date:"d M Y"|default:"-" }}</div>
      </td>
      <td class="text-center">
       
        <div class="field-value">{{ fq.valid_until|date:"d M Y"|default:"-" }}</div>
      </td>
      <td class="text-center" >
       
        <div class="field-value">{{ fq.payment_term }}</div>
      </td>
    </tr>
    
   </table>

<table class="service" style="width:100%">
  <tr>
    <th width="50%">SHIPPER</th>
    <th width="50%">CONSIGNEE</th>
  </tr>
  <tr>
    <td class="text-center">
      <address class="small mb-3">
        {% for line in fq.shipper_address_lines %}
          {{ line }}<br>
        {% endfor %}
      </address>

    </td>
    <td class="text-center">
      <address class="small mb-3">
  {% for line in fq.consignee_address_lines %}
    {{ line }}<br>
  {% endfor %}
</address>


    </td>
  </tr>
</table>

 <table class="pricing">
  <thead>
    <tr>
      <th class="text-left">CARGO DESCRIPTION</th>
      <th class="text-center" style="width:45px;">QTY</th>
      <th class="text-right"  style="width:95px;">PRICE</th>
      <th class="text-right"  style="width:95px;">AMOUNT</th>
      <th class="text-right"  style="width:95px;">TOTAL</th>
    </tr>
  </thead>
  <tbody>
    <!-- BARIS UTAMA (ITEM) -->
    <tr>
      <td>{{ fq.cargo_name }} <br/>
          {{ fq.package_count }} pkg |
    G.W: {{ fq.gross_weight }} {{ fq.weight_uom.code|default_if_none:"" }} |
    Volume: {{ fq.volume_cbm }} CBM
        
      </td>

      <!-- Qty: angka saja (tanpa mata uang) -->
      <td class="text-center">
        {{ fq.quantity|indo_number:0 }}
      </td>

      <!-- Unit Price -->
      <td class="text-right">
        {{ fq.unit_price|indo_currency:fq.currency.code }}
      </td>

      <!-- Amount = qty x price (gross) -->
      <td class="text-right">
        {{ fq.amount|indo_currency:fq.currency.code }}
      </td>

      <!-- Total (di baris utama) juga gross (qty x price) -->
      <td class="text-right">
        {{ fq.amount|indo_currency:fq.currency.code }}
      </td>
    </tr>

    <!-- BARIS DISCOUNT -->
    <tr>
      <td colspan="4" class="text-right" style="border:none">
        Disc ({{ fq.discount_percent|indo_number:2 }}%)
      </td>
      <td class="text-right">
        -{{ fq.discount_amount|indo_currency:fq.currency.code }}
      </td>
    </tr>

    <!-- BARIS TAX -->
    <tr>
      <td colspan="4" class="text-right" style="border:none">
        Tax ({{ fq.tax_percent|indo_number:2 }}%)
      </td>
      <td class="text-right">
        {{ fq.tax_amount|indo_currency:fq.currency.code }}
      </td>
    </tr>

    <!-- BARIS TOTAL AKHIR -->
    <tr>
      <td colspan="4" class="text-right" style="border:none"><strong>Total</strong></td>
      <td class="text-right">
        <strong>{{ fq.total_amount|indo_currency:fq.currency.code }}</strong>
      </td>
    </tr>
  </tbody>
</table>



  <!-- NOTES -->
  {% if fq.notes_customer %}
  <div style="margin:30px 0 30px 0"><strong>TERM & CONDITION</strong></div>
  <div class="customer-notes">
    {{ fq.notes_customer|safe }}
  </div>
{% endif %}


<!-- SIGN -->
  <div class="footer-sign">
    Best regards,<br><br><br>
    <strong>PT Dakara Samudera Hanasta</strong><br>
    <br>
    <br>
    <br>
    <br>
    <br>

    {{ fq.sales_user.get_full_name|default:fq.sales_user.username }}<br>
    Sales Department
  </div>
 

</div>

</div>

</body>
</html>
