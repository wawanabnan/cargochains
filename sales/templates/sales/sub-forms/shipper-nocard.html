{% if form.shipper.errors %}
  <div class="text-danger small mb-2">
    {{ form.shipper.errors|striptags }}
  </div>
{% endif %}

<div class="form-check mb-3">
  <input type="checkbox"
         class="form-check-input"
         id="id_shipper_same_as_customer">
  <label class="form-check-label" for="id_shipper_same_as_customer">
    Shipper sama dengan Customer
  </label>
</div>

<div class="row">
  <!-- Kolom kiri: pilih partner + contact & alamat text -->
  <div class="col-md-6">

    {# AUTOCOMPLETE SHIPPER (PARTNER) #}
    <div class="mb-3">
      <label for="id_shipper_text" class="form-label">Cari shipper (partner)</label>
      <input type="text"
             id="id_shipper_text"
             class="form-control js-partner"
             data-url="{% url 'partners:partner_autocomplete' %}"
             value="{% if form.instance.shipper %}
                      {{ form.instance.shipper.company_name|default:form.instance.shipper.name }}
                    {% endif %}">
      <input type="hidden"
             id="id_shipper"
             name="shipper"
             value="{% if form.instance.shipper_id %}{{ form.instance.shipper_id }}{% endif %}">
    </div>

    <div class="mb-3">
      {{ form.shipper_contact_name.label_tag }}
      {{ form.shipper_contact_name }}
      {% for err in form.shipper_contact_name.errors %}
        <div class="text-danger small">{{ err }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      {{ form.shipper_phone.label_tag }}
      {{ form.shipper_phone }}
      {% for err in form.shipper_phone.errors %}
        <div class="text-danger small">{{ err }}</div>
      {% endfor %}
    </div>

    <div class="mb-3">
      {{ form.shipper_address.label_tag }}
      {{ form.shipper_address }}
      {% for err in form.shipper_address.errors %}
        <div class="text-danger small">{{ err }}</div>
      {% endfor %}
    </div>

  </div>

  <!-- Kolom kanan: dropdown geo -->
  <div class="col-md-6">

    {# Province #}
    <div class="mb-3">
      <label for="id_shipper_province" class="form-label">Provinsi</label>
      {% with selected_prov=form.shipper_province.value|stringformat:"s" %}
      <select id="id_shipper_province"
              name="shipper_province"
              class="form-select">
        <option value="">---------</option>
        {% for prov in provinces %}
          <option value="{{ prov.id }}"
                  {% if prov.id|stringformat:"s" == selected_prov %}selected{% endif %}>
            {{ prov.name }}
          </option>
        {% endfor %}
      </select>
      {% endwith %}
      {% for err in form.shipper_province.errors %}
        <div class="text-danger small">{{ err }}</div>
      {% endfor %}
    </div>

    {# Regency #}
    <div class="mb-3">
      <label for="id_shipper_regency" class="form-label">Kabupaten / Kota</label>
      {% with selected_reg=form.instance.shipper_regency_id|stringformat:"s" %}
      <select id="id_shipper_regency"
              name="shipper_regency"
              class="form-select">
        <option value="">---------</option>
        {% for reg in shipper_regencies %}
          <option value="{{ reg.id }}"
                  {% if reg.id|stringformat:"s" == selected_reg %}selected{% endif %}>
            {{ reg.name }}
          </option>
        {% endfor %}
      </select>
      {% endwith %}

      {% for err in form.shipper_regency.errors %}
        <div class="text-danger small">{{ err }}</div>
      {% endfor %}
    </div>

    {# District #}
    <div class="mb-3">
      <label for="id_shipper_district" class="form-label">Kecamatan</label>
      {% with selected_dist=form.shipper_district.value|stringformat:"s" %}
      <select id="id_shipper_district"
              name="shipper_district"
              class="form-select">
        <option value="">---------</option>
        {% for dst in shipper_districts %}
          <option value="{{ dst.id }}"
                  {% if dst.id|stringformat:"s" == selected_dist %}selected{% endif %}>
            {{ dst.name }}
          </option>
        {% endfor %}
      </select>
      {% endwith %}
      {% for err in form.shipper_district.errors %}
        <div class="text-danger small">{{ err }}</div>
      {% endfor %}
    </div>

    {# Village #}
    <div class="mb-3">
      <label for="id_shipper_village" class="form-label">Kelurahan / Desa</label>
      {% with selected_vil=form.shipper_village.value|stringformat:"s" %}
      <select id="id_shipper_village"
              name="shipper_village"
              class="form-select">
        <option value="">---------</option>
        {% for vil in shipper_villages %}
          <option value="{{ vil.id }}"
                  {% if vil.id|stringformat:"s" == selected_vil %}selected{% endif %}>
            {{ vil.name }}
          </option>
        {% endfor %}
      </select>
      {% endwith %}
      {% for err in form.shipper_village.errors %}
        <div class="text-danger small">{{ err }}</div>
      {% endfor %}
    </div>

  </div>
</div>
