{% extends "adminbase.html" %}

{% block content %}
<div class="content-wrapper">

  <section class="content-header">
    <div class="container-fluid">

      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-2">
        <h3 class="mb-0">
          Freight Order {{ order.number }}
        </h3>

        {# Badge status kanan #}
        {% with s=order.status|default:"DRAFT"|upper %}
          <div>
            {% if s == "DRAFT" %}
              <span class="badge bg-secondary">Draft</span>
            {% elif s == "SENT" %}
              <span class="badge bg-primary">Sent</span>
            {% elif s == "ON_PROGRESS" %}
              <span class="badge bg-warning text-dark">On Progress</span>
            {% elif s == "COMPLETED" %}
              <span class="badge bg-success">Completed</span>
            {% elif s == "CANCELLED" %}
              <span class="badge bg-danger">Cancelled</span>
            {% elif s == "HOLDED" %}
              <span class="badge bg-info">Holded</span>
            {% else %}
              <span class="badge bg-light text-dark">{{ s|title }}</span>
            {% endif %}
          </div>
        {% endwith %}
      </div>

      {# Tombol aksi status (kiri) #}
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
        <div>
          <a href="{% url 'sales:fo_list' %}" class="btn btn-sm btn-outline-secondary me-2">
            <i class="fa fa-arrow-left me-1"></i> Kembali ke List
          </a>

          <form method="post"
                action="{% url 'sales:fo_change_status' order.pk %}"
                class="d-inline">
            {% csrf_token %}
            {% with s=order.status|default:"DRAFT"|upper %}
              {% if s == "DRAFT" %}
                <div class="btn-group btn-group-sm">
                  <button type="submit" name="action" value="sent"
                          class="btn btn-outline-primary">
                    Mark as Sent
                  </button>
                  <button type="submit" name="action" value="holded"
                          class="btn btn-outline-info">
                    Hold
                  </button>
                  <button type="submit" name="action" value="cancelled"
                          class="btn btn-outline-danger">
                    Cancel
                  </button>
                </div>

              {% elif s == "SENT" %}
                <div class="btn-group btn-group-sm">
                  <button type="submit" name="action" value="on_progress"
                          class="btn btn-outline-warning">
                    Mark as On Progress
                  </button>
                  <button type="submit" name="action" value="holded"
                          class="btn btn-outline-info">
                    Hold
                  </button>
                  <button type="submit" name="action" value="cancelled"
                          class="btn btn-outline-danger">
                    Cancel
                  </button>
                </div>

              {% elif s == "ON_PROGRESS" %}
                <div class="btn-group btn-group-sm">
                  <button type="submit" name="action" value="completed"
                          class="btn btn-outline-success">
                    Mark as Completed
                  </button>
                  <button type="submit" name="action" value="holded"
                          class="btn btn-outline-info">
                    Hold
                  </button>
                  <button type="submit" name="action" value="cancelled"
                          class="btn btn-outline-danger">
                    Cancel
                  </button>
                </div>

              {% elif s == "HOLDED" %}
                <div class="btn-group btn-group-sm">
                  <button type="submit" name="action" value="sent"
                          class="btn btn-outline-primary">
                    Back to Sent
                  </button>
                  <button type="submit" name="action" value="cancelled"
                          class="btn btn-outline-danger">
                    Cancel
                  </button>
                </div>
              {% endif %}
            {% endwith %}
          </form>
        </div>
      </div>

    </div>
  </section>

  <section class="content">
    <div class="container-fluid">

      {# ORDER INFO #}
      <div class="card mb-3">
        <div class="card-header bg-body-secondary">
          <strong>Order Information</strong>
        </div>
        <div class="card-body row g-3">
          <div class="col-md-4">
            <label class="form-label small">Order Number</label>
            <div>{{ order.number }}</div>
          </div>
          <div class="col-md-4">
            <label class="form-label small">Order Date</label>
            <div>{{ order.order_date|date:"Y-m-d" }}</div>
          </div>
          <div class="col-md-4">
            <label class="form-label small">Quotation</label>
            {% if order.quotation %}
              <div>
                <a href="{% url 'sales:fq_detail' order.quotation.pk %}">
                  {{ order.quotation.number }}
                </a>
              </div>
            {% else %}
              <div>-</div>
            {% endif %}
          </div>

          <div class="col-md-4">
            <label class="form-label small">Customer</label>
            <div>{{ order.customer.company_name|default:order.customer.name }}</div>
          </div>

          <div class="col-md-4">
            <label class="form-label small">Service</label>
            <div>{{ order.sales_service.name }}</div>
          </div>

          <div class="col-md-4">
            <label class="form-label small">Payment Term</label>
            <div>{{ order.payment_term.name }}</div>
          </div>
        </div>
      </div>

      {# ROUTE #}
      <div class="card mb-3">
        <div class="card-header bg-body-secondary">
          <strong>Route</strong>
        </div>
        <div class="card-body row g-3">
          <div class="col-md-6">
            <label class="form-label small">Origin</label>
            <div>{{ order.origin.name }}</div>
          </div>
          <div class="col-md-6">
            <label class="form-label small">Destination</label>
            <div>{{ order.destination.name }}</div>
          </div>
          <div class="col-md-4">
            <label class="form-label small">Plan Date</label>
            <div>{{ order.shipment_plan_date|date:"Y-m-d" }}</div>
          </div>
        </div>
      </div>

      {# CARGO #}
      <div class="card mb-3">
        <div class="card-header bg-body-secondary">
          <strong>Cargo Information</strong>
        </div>
        <div class="card-body row g-3">
          <div class="col-md-4">
            <label class="form-label small">Cargo Name</label>
            <div>{{ order.cargo_name }}</div>
          </div>
          <div class="col-md-4">
            <label class="form-label small">Package</label>
            <div>{{ order.package_count }} {{ order.package_type }}</div>
          </div>
          <div class="col-md-4">
            <label class="form-label small">Gross Weight</label>
            <div>{{ order.gross_weight }} {{ order.weight_uom }}</div>
          </div>
          <div class="col-md-4">
            <label class="form-label small">Volume (CBM)</label>
            <div>{{ order.volume_cbm }} {{ order.volume_uom }}</div>
          </div>
          <div class="col-md-4">
            <label class="form-label small">Dangerous Goods</label>
            <div>
              {% if order.is_dangerous_goods %}
                Yes ({{ order.dangerous_goods_class }})
              {% else %}
                No
              {% endif %}
            </div>
          </div>
        </div>
      </div>

      {# SHIPPER & CONSIGNEE #}
      <div class="card mb-3">
        <div class="card-header bg-body-secondary">
          <strong>Shipper & Consignee</strong>
        </div>
        <div class="card-body row g-3">
          <div class="col-md-6">
            <h6 class="fw-bold mb-2">Shipper</h6>
            <div><strong>{{ order.shipper_name }}</strong></div>
            <div>{{ order.shipper_address|linebreaksbr }}</div>
          </div>
          <div class="col-md-6">
            <h6 class="fw-bold mb-2">Consignee</h6>
            <div><strong>{{ order.consignee_name }}</strong></div>
            <div>{{ order.consignee_address|linebreaksbr }}</div>
          </div>
        </div>
      </div>

      {# PRICING #}
      <div class="card mb-3">
        <div class="card-header bg-body-secondary">
          <strong>Pricing</strong>
        </div>
        <div class="card-body row g-3">
          <div class="col-md-3">
            <label class="form-label small">Quantity</label>
            <div>{{ order.quantity }}</div>
          </div>
          <div class="col-md-3">
            <label class="form-label small">Unit Price</label>
            <div>{{ order.unit_price }}</div>
          </div>
          <div class="col-md-3">
            <label class="form-label small">Amount</label>
            <div>{{ order.amount }}</div>
          </div>
          <div class="col-md-3">
            <label class="form-label small">Discount</label>
            <div>{{ order.discount_percent }} % ({{ order.discount_amount }})</div>
          </div>
          <div class="col-md-3">
            <label class="form-label small">Tax</label>
            <div>{{ order.tax_percent }} % ({{ order.tax_amount }})</div>
          </div>
          <div class="col-md-3">
            <label class="form-label small">Total Amount</label>
            <div>{{ order.total_amount }}</div>
          </div>
        </div>
      </div>

      {# NOTES #}
      <div class="card mb-3">
        <div class="card-header bg-body-secondary">
          <strong>Internal Notes</strong>
        </div>
        <div class="card-body">
          <div>{{ order.notes_internal|default:"-"|linebreaksbr }}</div>
        </div>
      </div>

    </div>
  </section>

</div>
{% endblock %}
