{% extends "adminbase.html" %}
{% load indo_format %}

{% block content %}

<div class="app-header">
  <div class="container-fluid py-2 d-flex justify-content-between align-items-center flex-wrap">
    <h5 class="mb-0">Invoices</h5>

    <a href="{% url 'sales:invoice_add' %}" class="btn btn-primary btn-sm">
      <i class="fa fa-plus me-1"></i> New Invoice
    </a>
  </div>
</div>

<div class="app-content">

  <div class="container-fluid mb-3">
    <form method="get" class="row g-2 align-items-end">
      <div class="col-md-3">
        <label class="form-label mb-1">Search</label>
        <input type="text" name="q" value="{{ q }}" class="form-control form-control-sm"
               placeholder="Invoice no, customer...">
      </div>

      <div class="col-md-3">
        <label class="form-label mb-1">Status</label>
        <select name="status" class="form-select form-select-sm">
          <option value="">-- All --</option>
          {% for value, label in status_choices %}
            <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>
              {{ label }}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="col-md-3">
        <button class="btn btn-primary btn-sm me-2">
          <i class="fa fa-search me-1"></i> Filter
        </button>
        <a href="{% url 'sales:invoice_list' %}" class="btn btn-outline-secondary btn-sm">Reset</a>
      </div>
    </form>
  </div>

  <div class="container-fluid">
    <div class="card shadow-sm">
      <div class="card-body p-0">

        <div class="table-responsive">
          <table class="table table-hover table-sm mb-0 align-middle" id="invoiceTable">
            <thead class="table-light">
              <tr>
                <th style="width:30px;">
                  <input type="checkbox" class="form-check-input" id="chkAll">
                </th>
                <th  style="width:170px;">Invoice No</th>
                <th  style="width:140px;">Date</th>
                <th>Customer</th>
                <th class="text-end">Total</th>
                <th class="text-end">Outstanding</th>
                <th class="text-center" style="width:140px;"">Status</th>
               
              </tr>
            </thead>

            <tbody>
              {% for inv in invoices %}
                <tr class="clickable-row" data-href="{% url 'sales:invoice_detail' inv.pk %}">
                  <td>
                    <input type="checkbox" class="form-check-input row-check">
                  </td>

                  <td>{{ inv.number }}</td>
                  <td>{{ inv.invoice_date|date:"d M Y" }}</td>

                  <td>{{ inv.customer.company_type inv.customer.company_name }}</td>

                  <td class="text-end">{{ inv.total_amount|indo_currency }}</td>
                  <td class="text-end">{{ inv.amount_outstanding|indo_currency }}</td>

                  <td class="text-center">
                    <span class="badge bg-secondary">{{ inv.get_status_display }}</span>
                  </td>

                </tr>
              {% empty %}
                <tr>
                  <td colspan="8" class="text-center py-3">Tidak ada invoice.</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

      </div>
    </div>
  </div>

</div>

{% endblock %}

{% block extra_js %}
<script>
  // Klik row â†’ masuk detail
  document.querySelectorAll(".clickable-row").forEach(row => {
      row.addEventListener("click", function () {
        const href = this.dataset.href;
        if (href) window.location = href;
      });
  });

  // Stop klik checkbox agar tidak trigger klik row
  document.querySelectorAll(".row-check").forEach(chk => {
      chk.addEventListener("click", function (e) {
          e.stopPropagation();
      });
  });

  // Select all
  const chkAll = document.getElementById("chkAll");
  chkAll.addEventListener("click", function(){
      const checks = document.querySelectorAll(".row-check");
      checks.forEach(c => c.checked = chkAll.checked);
  });
</script>
{% endblock %}
