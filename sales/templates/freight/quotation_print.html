{% load static %}
<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Quotation {{ q.number }}</title>
  <style>
    @page { size: A4; margin: 15mm 15mm 18mm 15mm; }

    body { font-family: Arial, Helvetica, sans-serif; font-size: 12px; color: #111; margin: 0;}
    .muted { color:#666; }
    .h1 { font-size: 20px; font-weight: bold; margin: 0; }
    .h3 { font-size: 13px; font-weight: bold; margin: 0 0 6px 0; }

    /* Center di browser, tetap aman di PDF */
    .page { width: 800px; margin: 0 auto; }
    .wrap-table { width: 100%; }
    .wrap-cell { width: 100%; }

    /* Header pakai table fix-width agar tidak tumpuk */
    table.header { width:100%; border-collapse:collapse; margin-bottom:10px; }
    table.header td { vertical-align:top; }
    .logo-cell { width: 120px; }
    .title-cell { text-align:right; }

    .box { border: 1px solid #ddd; padding: 8px; margin-bottom: 8px; }
    .kv { margin:0; padding:0; }
    .kv dt { float:left; width:120px; color:#666; }
    .kv dd { margin-left:130px; margin-bottom:4px; }

    table.lines { width:100%; border-collapse: collapse; margin-top: 8px; }
    table.lines th, table.lines td { border:1px solid #ddd; padding:6px; }
    table.lines th { background:#f5f5f5; text-align:left; }
    td.num { text-align:right; }

    table.totals { width:280px; margin-left:auto; border-collapse: collapse; margin-top: 10px; }
    table.totals td { padding:4px 0; border: none; }
    table.totals .label { color:#666; }

    .footer { margin-top: 14px; color:#666; font-size:11px; }

    /* tombol print hanya saat browser */
    .actions { margin: 8px 0 12px; }
    .btn { padding:6px 10px; font-size:12px; border:1px solid #ddd; background:#fff; text-decoration:none; color:#333; border-radius:4px; }
    @media print { .actions { display:none; } .page { width:auto; margin:0; } }
  </style>
</head>
<body>

  <!-- wrapper agar center juga di PDF -->
  <table class="wrap-table" align="center">
    <tr><td class="wrap-cell">

      <div class="page">

        <!-- HEADER -->
        <table class="header">
          <tr>
            <td class="logo-cell">
              <img src="{% static 'adminlte/img/logo.png' %}" alt="Logo" style="height:60px;">
            </td>
            <td class="title-cell">
              <div class="h1">Quotation</div>
              <div class="muted">Number: {{ q.number }}</div>
              <div style="margin-top:4px;">
                <b>Status:</b> {{ q.get_status_display }}<br>
                {% if q.date %}<b>Date:</b> {{ q.date }}<br>{% endif %}
                {% if q.valid_until %}<b>Valid Until:</b> {{ q.valid_until }}{% endif %}
              </div>
            </td>
          </tr>
        </table>

        {% if not is_pdf %}
        <div class="actions">
          <a href="#" class="btn" onclick="window.print()">Print</a>
        </div>
        {% endif %}

        <!-- CUSTOMER & DETAILS -->
        <table style="width:100%; border-collapse:collapse;">
          <tr>
            <td style="width:50%; padding-right:6px;">
              <div class="box">
                <div class="h3">Customer</div>
                <dl class="kv">
                  <dt>Name</dt><dd>{{ q.customer }}</dd>
                  {% if q.customer and q.customer.address %}<dt>Address</dt><dd>{{ q.customer.address }}</dd>{% endif %}
                  {% if q.customer and q.customer.email %}<dt>Email</dt><dd>{{ q.customer.email }}</dd>{% endif %}
                  {% if q.customer and q.customer.phone %}<dt>Phone</dt><dd>{{ q.customer.phone }}</dd>{% endif %}
                </dl>
              </div>
            </td>
            <td style="width:50%; padding-left:6px;">
              <div class="box">
                <div class="h3">Details</div>
                <dl class="kv">
                  {% if q.currency %}<dt>Currency</dt><dd>{{ q.currency }}</dd>{% endif %}
                  {% if q.payment_term %}<dt>Payment Term</dt><dd>{{ q.payment_term }}</dd>{% endif %}
                  {% if q.sales_service %}<dt>Service</dt><dd>{{ q.sales_service }}</dd>{% endif %}
                  {% if q.business_type %}<dt>Business Type</dt><dd>{{ q.business_type|upper }}</dd>{% endif %}
                </dl>
              </div>
            </td>
          </tr>
        </table>

        <!-- LINES -->
        <table class="lines">
          <thead>
            <tr>
              <th style="width:28px">#</th>
              <th>Origin</th>
              <th>Destination</th>
              <th>Description</th>
              <th style="width:80px">UoM</th>
              <th style="width:70px" class="num">Qty</th>
              <th style="width:90px" class="num">Price</th>
              <th style="width:110px" class="num">Amount</th>
            </tr>
          </thead>
          <tbody>
            {% for ln in q.lines.all %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ ln.origin.name }}</td>
              <td>{{ ln.destination.name }}</td>
              <td>{{ ln.description }}</td>
              <td>{{ ln.uom }}</td>
              <td class="num">{{ ln.qty }}</td>
              <td class="num">{{ ln.price|floatformat:2 }}</td>
              <td class="num">{{ ln.amount|floatformat:2 }}</td>
            </tr>
            {% empty %}
            <tr><td colspan="8" class="num">No lines.</td></tr>
            {% endfor %}
          </tbody>
        </table>

        <!-- TOTALS -->
        <table class="totals">
          <tr><td class="label">Subtotal</td><td class="num">{{ q.total|floatformat:2 }}</td></tr>
          <tr><td class="label">VAT</td><td class="num">{{ q.vat|floatformat:2 }}</td></tr>
          <tr><td class="label"><b>Grand Total</b></td><td class="num"><b>{{ q.grand_total|floatformat:2 }}</b></td></tr>
        </table>

        {% if q.note_1 %}
        <div class="footer">
           <p>Note</p> 
          <div style="width:50%">
           
              {{ q.note_1 }}
                       
          </div>
        </div>
        {% endif %}
        <div style="margin-top:135px">
          {{ q.sales_user.first_name }}

        </div>

      </div>

    </td></tr>
  </table>
</body>
</html>
