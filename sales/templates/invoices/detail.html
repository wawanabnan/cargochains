{% extends "adminbase.html" %}
{% load indo_format %}
{% block content %}

<div class="app-content-header">
  <div class="container-fluid">
    <div class="d-flex align-items-center">

      <!-- LEFT: TITLE -->
      <h4 class="mb-0">Invoice</h4>

      <!-- RIGHT: ACTIONS -->
      <div class="ms-auto d-flex align-items-center gap-2">

        <a class="btn btn-outline-secondary btn-sm"
           href="{% url 'sales:invoice_list' %}">
          <i class="bi bi-arrow-left me-1"></i> Back
        </a>

        <a class="btn btn-outline-primary btn-sm"
           href="{% url 'sales:invoice_edit' invoice.pk %}">
          <i class="bi bi-pencil-square me-1"></i> Edit
        </a>

        <a class="btn btn-outline-primary btn-sm"
           href="{% url 'sales:invoice_pdf' invoice.pk %}"
           target="_blank"
           rel="noopener">
          <i class="bi bi-file-earmark-pdf me-1"></i> PDF
        </a>

      </div>
    </div>
  </div>
</div>



<div class="app-content">
   <div class="container-fluid">

    <div class="row g-3">
      <div class="col-12">
        <div class="card card-body">

          <div class="row g-4">

            <!-- LEFT: HEADER -->
            <div class="col-lg-6">
             
              <div class="row mb-2">
                <div class="col-5 text-muted">Customer</div>
                <div class="col-7">
                  {% if invoice.customer %}{{ invoice.customer.name }}{% else %}-{% endif %}
                </div>
              </div>

              <div class="row mb-2">
                <div class="col-5 text-muted">Invoice Date</div>
                <div class="col-7">{{ invoice.invoice_date }}</div>
              </div>

              <div class="row mb-2">
                <div class="col-5 text-muted">Due Date</div>
                <div class="col-7">{{ invoice.due_date }}</div>
              </div>

              <div class="row mb-2">
                <div class="col-5 text-muted">Status</div>
                <div class="col-7">
                  <span class="badge bg-secondary">{{ invoice.status }}</span>
                </div>
              </div>

              {% if invoice.job_order %}
              <div class="row mb-2">
                <div class="col-5 text-muted">Job Order</div>
                <div class="col-7">{{ invoice.job_order.number }}</div>
              </div>
              {% endif %}
            </div>

            <!-- RIGHT: TOTALS -->
            <div class="col-lg-6">
              <h6 class="mb-3">Totals</h6>

              <div class="row mb-2">
                <div class="col-6 text-muted">Subtotal</div>
                <div class="col-6 text-end">{{ invoice.subtotal_amount }}</div>
              </div>

              <div class="row mb-2">
                <div class="col-6 text-muted">Tax</div>
                <div class="col-6 text-end">{{ invoice.tax_amount }}</div>
              </div>

              <hr class="my-2">

              <div class="row mb-0">
                <div class="col-6 fw-semibold">Grand Total</div>
                <div class="col-6 text-end fw-semibold">{{ invoice.total_amount }}</div>
              </div>
            </div>

          </div>

        </div>
      </div>
    </div>

      <div class="card card-body mt-3 p-0" >
       

        <div class="table-responsive p-0">
          <table class="table table-sm align-middle mb-0 ">
            <thead>
              <tr>
                <th style="width:60px;">No</th>
                <th>Description</th>
                <th class="text-end" style="width:120px;">Qty</th>
                <th class="text-end" style="width:150px;">Price</th>
                <th class="text-center" style="width:150px;">Tax</th>
                <th class="text-end" style="width:160px;">Amount</th>
              </tr>
            </thead>
            <tbody>
              {% for ln in invoice.lines.all %}
                <tr>
                  <td class="text-muted">{{ forloop.counter }}</td>
                  <td style="white-space:pre-line;">{{ ln.description }}</td>
                  <td class="text-end">{{ ln.quantity|indo_number }}</td>
                
                  <td class="text-end">{{ ln.price|indo_number  }}</td>
                    <td class="text-center">
                  {% for tx in ln.taxes.all %}
                    {{ tx.rate }}{% if not forloop.last %}, {% endif %}
                  {% empty %}
                    -
                  {% endfor %}
                </td>
                  <td class="text-end">{{ ln.amount|indo_currency }}</td>
                </tr>
              {% empty %}
                <tr>
                  <td colspan="5" class="text-center text-muted">Belum ada line.</td>
                </tr>
              {% endfor %}
            </tbody>
            <tfoot>
              <tr>
                <td colspan="5">Sub Total</td>
                <td colspan="5"></td>
                

              </tr>
            </tfoot>
          </table>
        </div>

      </div>

      <div class="row g-3 mt-1">
        <div class="col-lg-6">
          <div class="card card-body">
            <h6 class="mb-2">Notes to Customer</h6>
            <div class="text-muted" style="white-space:pre-line;">{{ invoice.notes_customer|default:"-" }}</div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card card-body">
            <h6 class="mb-2">Internal Notes</h6>
            <div class="text-muted" style="white-space:pre-line;">{{ invoice.notes_internal|default:"-" }}</div>
          </div>
        </div>
      </div>

  </div>
</div>

{% endblock %}
{% block extra_css %}
<style>
 
</style>
{% endblock %}