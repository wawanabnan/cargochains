{% load static %}
{% load indo_format %}

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Revenue Report {{ job.number }}</title>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #ffffff !important;
    }

    body {
      font-family: "Segoe UI", Arial, sans-serif;
      font-size: 12px;
    }

    .page {
      margin: 0 auto;
      box-sizing: border-box;
      padding: 0 18mm 10mm 18mm;
      background: transparent;
    }

    #title  {
        font-size: 24px;
        margin:50px 0;
        text-align: center;
    }

    #title h1 {
        font-size: 24px;
        
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    th, td {
      padding: 4px 6px;
      vertical-align: top;
    }

    .text-left   { text-align: left; }
    .text-right  { text-align: right; }
    .text-center { text-align: center; }

    .header-table td {
      vertical-align: top; 
    }

    .doc-title {
      font-size: 18px;
      font-weight: bold;
      letter-spacing: 1px;
    }

    .doc-subtitle {
      font-size: 12px;
    }

    .section-title {
      margin-top: 10px;
      margin-bottom: 4px;
      font-weight: bold;
      font-size: 12px;
      text-transform: uppercase;
    }

    .summary-table {
      width: auto;
      font-size: 11px;
    }

    .summary-table td {
      padding: 2px 4px;
    }

    .table-bordered,
    .table-bordered th,
    .table-bordered td {
      border: 1px solid #666;
    }

    /* STRIPED ROWS UNTUK TBODY SAJA */
    .table-striped tbody tr:nth-child(odd) {
      background-color: #ffffff;
    }

    .table-striped tbody tr:nth-child(even) {
      background-color: #f3f3f3;
    }

    .table-striped th {

        background-color: #f3f3f3;
    }

    .muted {
      color: #777;
      font-size: 10px;
    }

    .small {
      font-size: 10px;
    }

    .mt-5 { margin-top: 5px; }
    .mt-10 { margin-top: 10px; }
    .mb-5 { margin-bottom: 5px; }
    .mb-10 { margin-bottom: 10px; }

    @media print {
      html, body { background: #ffffff !important; }
      .page { margin: 0 auto; }
    }

  
  </style>
</head>
<body>

<div class="page">

    <div id="title"><h2>JOB FILE</h2></div>

  {# ====================================================== #}
  {#  HEADER: JO, CUSTOMER, REVENUE IDR                     #}
  {# ====================================================== #}
<table class="header-table">
  <tr>
    <td style="width: 55%;">

      <div class="doc-subtitle">
        Job No&nbsp;: {{ job.number }}<br>
        Date&nbsp;&nbsp;&nbsp;: {{ job.job_date|date:"d M Y"|default:"-" }}<br>
        Customer :
        {{ job.customer.company_name|default:job.customer.name }}<br>
        To :
        {{ to_display }}
      </div>

      <div class="small mt-5">
        Service : {{ job.service.name }} ({{ job.service.service_group }})<br>
        Sales :
        {% if job.sales_user %}
          {{ job.sales_user.get_full_name|default:job.sales_user.username }}
        {% else %}
          -
        {% endif %}
      </div>
    </td>

    <td style="width: 45%; text-align: right;">
      <table class="summary-table" style="float: right;">
        <tr>
          <td class="text-left">Currency</td>
          <td class="text-right">
            {{ currency_code }}
          </td>
        </tr>

        {% if currency_code != "IDR" %}
          <tr>
            <td class="text-left">Kurs → IDR</td>
            <td class="text-right">
              {{ kurs|indo_number }}
            </td>
          </tr>
        {% endif %}

        {% if job.is_tax and job.tax_amount %}
          <tr>
            <td class="text-left">Tax ({{ currency_code }})</td>
            <td class="text-right">
              {{ job.tax_amount|indo_number }} {{ job.currency.code }}
            </td>
          </tr>
        {% endif %}

        {% if job.is_pph and job.pph_amount %}
          <tr>
            <td class="text-left">PPH ({{ currency_code }})</td>
            <td class="text-right">
              {{ job.pph_amount|indo_number }} {{ job.currency.code }}
            </td>
          </tr>
        {% endif %}

        <tr>
          <td class="text-left">Grand Total ({{ currency_code }})</td>
          <td class="text-right">
            {{ job.grand_total|indo_number }} {{ job.currency.code }}
          </td>
        </tr>

        <tr>
          <td class="text-left"><strong>Revenue (IDR)</strong></td>
          <td class="text-right">
            <strong>{{ revenue_idr|indo_number }} IDR</strong>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>


  <br>

  {# ====================================================== #}
  {#  JOB INFORMATION                                       #}
  {# ====================================================== #}
  <div class="section-title">Job Information</div>

  <table class="table-bordered">
    <tr>
      <th class="text-left" style="width: 20%;">Cargo Description</th>
      <td class="text-left" style="width: 30%;">
        {{ job.cargo_description|default:"-" }}
      </td>
      <th class="text-left" style="width: 20%;">Quantity</th>
      <td class="text-left" style="width: 30%;">
        {% if job.quantity %}
          {{ job.quantity|indo_number }}
        {% else %}
          -
        {% endif %}
      </td>
    </tr>
   
    <tr>
      <th class="text-left">Payment Term</th>
      <td class="text-left">
        {{ job.payment_term.name|default:"-" }}
      </td>
      <th class="text-left">Remarks</th>
      <td class="text-left">
        {{ job.remarks_internal|default:"-" }}
      </td>
    </tr>
     <tr>
      <th colspan="2" class="text-left">Pick Up</th>
     
      <th colspan="2" class="text-left">Delivery</th>
     
    </tr>
    <tr>
        <td colspan="2"><div style="min-height:50px"> {{ job.pickup|default:"-" }}</div></td>
        <td colspan="2"><div style="min-height:50px"> {{ job.delivery|default:"-" }}</div></td>
       
    </tr>
  </table>

  <br>

  {# ====================================================== #}
  {#  COGS (IDR) — JOB COST + TAX                          #}
  {# ====================================================== #}
  <div class="section-title">COGS Estimation</div>

  <table class="table-bordered table-cogs ">
    <thead>
      <tr>
        <th style="width: 25px; background-color: #f3f3f3;" class="text-center">NO</th>
        <th class="text-left" style="background-color: #f3f3f3">DESCRIPTION</th>
        <th style="width: 60px;background-color: #f3f3f3" class="text-center">QTY</th>
         <th style="width: 60px;background-color: #f3f3f3" class="text-center">PRICE</th>
        <th style="width: 120px;background-color: #f3f3f3" class="text-right">AMOUNT (IDR)</th>
      </tr>
    </thead>
    <tbody>
      {% if costs %}
        {% for c in costs %}
          <tr>
            <td class="text-center">{{ forloop.counter }}</td>
            <td class="text-left">{{ c.description }}</td>
            <td class="text-center">
              {% if c.qty %}
                {{ c.qty|indo_number }}
              {% else %}
                -
              {% endif %}
            </td>
             <td class="text-center">
              {% if c.price %}
                {{ c.price|indo_number }}
              {% else %}
                -
              {% endif %}
            </td>
            <td class="text-right">
              {% if c.amount %}
                {{ c.amount|indo_number }}
              {% else %}
                0,00
              {% endif %}
            </td>
          </tr>
        {% endfor %}

        {% if tax_idr %}
          {# Baris TAX sebagai bagian COGS #}
          <tr>
            <td class="text-center">
              {{ costs|length|add:"1" }}
            </td>
            <td class="text-left">
              VAT 1.1 % 
            </td>
            <td class="text-center">-</td>
            <td class="text-center">-</td>
            
            <td class="text-right">
              {{ tax_idr|indo_number }}
            </td>
          </tr>
        {% endif %}
      {% else %}
        <tr>
          <td colspan="4" class="text-center muted" style="padding: 10px 4px;">
            No job cost recorded.
          </td>
        </tr>
      {% endif %}
    </tbody>
    {% if costs or tax_idr %}
      <tfoot>
        <tr>
          <th colspan="4"  style="background-color: #f3f3f3;text-align: left;">
            TOTAL COGS (IDR)
          </th>
          <th class="text-right" style="background-color: #f3f3f3;">
            {{ total_cogs_idr|indo_number }}
          </th>
        </tr>
      </tfoot>
    {% endif %}
  </table>

  <br>

  {# ====================================================== #}
  {#  GROSS PROFIT (IDR)                                   #}
  {# ====================================================== #}
  <div class="section-title">Revenue Forcast</div>

  <table class="table-bordered">
    <tbody>
      <tr>
        <td class="text-left" style="width: 70%;">
          Revenue - {{ job.service.name }} ({{ job.service.service_group }})
        </td>
        <td class="text-right" style="width: 30%;">
          {{ revenue_idr|indo_number }}
        </td>
      </tr>
      <tr>
        <td class="text-left">
           Cost of good sold
        </td>
        <td class="text-right">
          {{ total_cogs_idr|indo_number }}
        </td>
      </tr>
      <tr>
        <td class="text-left">
          <strong>Gross Profit (IDR)</strong>
        </td>
        <td class="text-right">
          <strong>{{ gross_profit_idr|indo_number }}</strong>
        </td>
      </tr>
    </tbody>
  </table>

  <br>

 

</div>

</body>
</html>
