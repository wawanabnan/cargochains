{# templates/sales/job_order_detail.html #}
{% extends "adminbase.html" %}
{% load static %}
{% load indo_format %}  {# kalau filter indo_number ada di sini #}

{% block content %}

<div class="app-content">
  <div class="container-fluid">

    {# HEADER #}
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h1 class="h4 mb-0">Job Order Detail</h1>
        <div class="text-muted small">
          Job No: <strong>{{ job.number }}</strong><br>
          Date: {{ job.job_date|date:"d-m-Y" }}
        </div>
      </div>
      <div class="d-flex gap-2">
        <a href="{% url 'sales:job_order_list' %}"
           class="btn btn-outline-secondary btn-sm">
          <i class="fa fa-arrow-left me-1"></i> Back to List
        </a>
        <a href="{% url 'sales:job_order_edit' job.pk %}"
           class="btn btn-primary btn-sm">
          <i class="fa fa-edit me-1"></i> Edit
        </a>
        <form method="post" action="{% url 'sales:invoice_generate_from_job' job.pk %}">
  {% csrf_token %}
  <button class="btn btn-sm btn-primary">Generate Invoice</button>
</form>

        <a href="{% url 'sales:job_order_revenue_pdf' job.pk %}"
            class="btn btn-outline-primary btn-sm"
            target="_blank">
            <i class="fa fa-file-pdf me-1"></i> Revenue PDF
          </a>

      </div>
    </div>





    <div class="card">
      <div class="card-header">Job Information</div>
      <div class="card-body">
        <div class="row">
            <div class="col">
                 <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Customer</label>
              <div class="col-sm-8">
                <div class="form-control-plaintext form-control-sm">
                  {{ job.customer.company_name|default:job.customer.name }}
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Service</label>
              <div class="col-sm-8">
                <div class="form-control-plaintext form-control-sm">
                  {{ job.service.name }} ({{ job.service.service_group }})
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Cargo</label>
              <div class="col-sm-8">
                <div class="form-control-plaintext form-control-sm">
                  {{ job.cargo_description|default:"-" }}
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Pickup</label>
              <div class="col-sm-8">
                <div class="form-control-plaintext form-control-sm">
                  {{ job.pickup|default:"-" }}
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Delivery</label>
              <div class="col-sm-8">
                <div class="form-control-plaintext form-control-sm">
                  {{ job.delivery|default:"-" }}
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">PIC</label>
              <div class="col-sm-8">
                <div class="form-control-plaintext form-control-sm">
                  {{ job.pic|default:"-" }}
                </div>
              </div>
            </div>


            </div>
            <div class="col">
                 <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Payment Term</label>
              <div class="col-sm-8">
                <div class="form-control-plaintext form-control-sm">
                  {{ job.payment_term.name }}
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Currency</label>
              <div class="col-sm-8">
                <div class="form-control-plaintext form-control-sm">
                  {{ job.currency.code }}
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Total Amount</label>
              <div class="col-sm-8 text-end">
                <div class="form-control-plaintext form-control-sm">
                  {{ job.total_amount|indo_number }}
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Tax</label>
              <div class="col-sm-8 text-end">
                <div class="form-control-plaintext form-control-sm">
                  {{ job.tax_amount|indo_number }}
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Grand Total</label>
              <div class="col-sm-8 text-end">
                <div class="form-control-plaintext form-control-sm fw-semibold">
                  {{ job.grand_total|indo_number }}
                </div>
              </div>
            </div>

            <div class="row mb-2">
              <label class="col-sm-4 col-form-label col-form-label-sm">Sales</label>
              <div class="col-sm-8">
                <div class="form-control-plaintext form-control-sm">
                  {% if job.sales_user %}
                    {{ job.sales_user.get_full_name|default:job.sales_user.username }}
                  {% else %}
                    -
                  {% endif %}
                </div>
              </div>
            </div>


            </div>
        </div>
      </div>

    </div>
    {#===========================================#}
    <ul class="nav nav-pills nav-fill  mynav mt-2" 
                id="myTab" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active " 
                        id="home-tab" 
                        data-bs-toggle="tab" data-bs-target="#costTab" 
                        type="button" role="tab" 
                        aria-controls="home" aria-selected="true">Job Cost
                </button>
              </li>
               <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        id="home-tab" 
                        data-bs-toggle="tab" data-bs-target="#noteTab" 
                        type="button" role="tab" 
                        aria-controls="home" aria-selected="true">Note
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" 
                        id="profile-tab" 
                        data-bs-toggle="tab" data-bs-target="#attachmentTab" 
                        type="button" role="tab" 
                        aria-controls="profile" aria-selected="false">Attachment
                </button>
              </li>
              
            
            </ul>
            <div class="tab-content border border-0 mt-3" id="myCargoPriceTab">
                <div class="tab-pane fade show active" 
                    id="costTab" 
                    role="tabpanel" aria-labelledby="cargotab">
                     {% include 'job_orders/extension/cost_detail.html' %}


                </div>
                 <div class="tab-pane fade show active" 
                    id="noteTab" 
                    role="tabpanel" aria-labelledby="notetab">
                    

                </div>
                <div class="tab-pane fade" 
                      id="attachmentTab" 
                      role="tabpanel" aria-labelledby="price-tab">
                       {% include 'job_orders/extension/attachment.html' %}

                </div>
                 
            </div>





  </div>
  
</div>

{% endblock %}
{% block extra_css %}

<style>
#myTab {border:none}  
#myTab .nav-link {
    background-color: #cdcacd !important;  /* warna background active */
    border-radius: 0;
    color: #fff !important;                /* warna teks */
    text-transform: uppercase;

}

#myTab .nav-link.active {
    background-color: #ab1680 !important;  /* warna background active */
    border-radius: 0;
    color: #fff !important;            
    font-weight: bold;
}

.mynav > .nav-pills .mynav > .nav-link.active {
    background-color:blueviolet /* Replace with your desired color code */
    color: #F0F8FF; /* Optional: Change text color for contrast */
}


.tab-content {
  padding: 0px;
  min-height: 100px;
  background-color: #fff;
}



</style>
{% endblock %}
